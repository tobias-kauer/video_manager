<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Top-Screen Window</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="idle-animation" class="animation-container">

        <div id="idle-animation-1" class="text-container">
            <h1 class="main-text"></h1>
        </div>

    </div>

    <div id="room-animation" class="animation-container" style="display:none;">

        <div id="room-animation-1" class="text-container" style="display: none; opacity: 0;">
            <h1 class="main-text">AI affects us all</h1>
        </div>

        <div id="room-animation-2" class="text-container" style="display: none; opacity: 0;">
          <h1 id="room-animation-2a" class="main-text" style=" opacity: 0;">AI is deciding for you</h1>
          <h1 id="room-animation-2b" class="main-text" style=" opacity: 0;">AI is deciding about you</h1>
        </div>

        <div id="room-animation-3" class="text-container" style="display: none; opacity: 0;">
          <h1 class="main-text">AI is being used everywhere</h1>

          <div id="scroll-container">
            <ul id="scroll-list-1" class="scroll-list">
              <li class="small-text">Credit scoring</li>
              <li class="small-text">Customer risk profiling</li>
              <li class="small-text">Loan application screening</li>
              <li class="small-text">Insurance claim automation</li>
              <li class="small-text">Student performance prediction</li>
              <li class="small-text">Curriculum optimization</li>
              <li class="small-text">Healthcare diagnostics</li>
              <li class="small-text">Biometric tracking</li>
              <li class="small-text">Voice profiling</li>
              <li class="small-text">Mental health chatbots</li>
              <li class="small-text">Medical imaging analysis</li>
              <li class="small-text">Biometric tracking</li>
              <li class="small-text">Voice profiling</li>
              <li class="small-text">Mental health chatbots</li>
              <li class="small-text">Medical imaging analysis</li>
              <li class="small-text">Biometric tracking</li>
              <li class="small-text">Voice profiling</li>
              <li class="small-text">Mental health chatbots</li>
              <li class="small-text">Medical imaging analysis</li>
            </ul>
            
            <ul id="scroll-list-2" class="scroll-list">
              <li class="small-text">Predictive policing</li>
              <li class="small-text">Facial recognition</li>
              <li class="small-text">Surveillance analytics</li>
              <li class="small-text">Behavioral nudging</li>
              <li class="small-text">Dynamic pricing</li>
              <li class="small-text">Emotion detection</li>
              <li class="small-text">Automated censorship</li>
              <li class="small-text">Retail recommendation</li>
              <li class="small-text">Ad targeting</li>
              <li class="small-text">Algorithmic trading</li>
              <li class="small-text">Credit scoring</li>
              <li class="small-text">Robo-advisors</li>
              <li class="small-text">Biometric tracking</li>
              <li class="small-text">Voice profiling</li>
              <li class="small-text">Mental health chatbots</li>
              <li class="small-text">Medical imaging analysis</li>
              <li class="small-text">Biometric tracking</li>
              <li class="small-text">Voice profiling</li>
              <li class="small-text">Mental health chatbots</li>
              <li class="small-text">Medical imaging analysis</li>
            </ul>
            
            <ul id="scroll-list-3" class="scroll-list">
              <li class="small-text">Autonomous vehicles</li>
              <li class="small-text">Traffic management systems</li>
              <li class="small-text">Maintenance in aviation</li>
              <li class="small-text">Driver behavior analysis</li>
              <li class="small-text">Content recommendation</li>
              <li class="small-text">Smart home automation</li>
              <li class="small-text">Home security systems</li>
              <li class="small-text">Appliance control</li>
              <li class="small-text">Elderly care monitoring</li>
              <li class="small-text">Content moderation</li>
              <li class="small-text">Game character behavior</li>
              <li class="small-text">Biometric tracking</li>
              <li class="small-text">Voice profiling</li>
              <li class="small-text">Mental health chatbots</li>
              <li class="small-text">Medical imaging analysis</li>
              <li class="small-text">Biometric tracking</li>
              <li class="small-text">Voice profiling</li>
              <li class="small-text">Mental health chatbots</li>
              <li class="small-text">Medical imaging analysis</li>
            </ul>
            
          </div>
        </div>
      

        <div id="room-animation-4" class="text-container" style="display: none; opacity: 0;">
            <h1 class="main-text-smaller">...but is developed by just a few companies</h1>

            <div id="scroll-container">
              <ul id="scroll-list">
                <li class="small-text">OpenAI</li>
                <li class="small-text">Google</li>
                <li class="small-text">Meta</li>
                <li class="small-text">Microsoft</li>
                <li class="small-text">Anthropic</li>
              </ul>
            </div>
        </div>
        

        <div id="room-animation-5" class="text-container" style="display: none; opacity: 0;">
              <h1 class="main-text">...behind closed doors and undemocratic</h1>
        </div>

        <div id="room-animation-6" class="text-container" style="display: none; opacity: 0;">
          <h1 class="main-text-header" style="font-size: 120px;">THE FUTURE OF AI</h1>
          <h1 class="main-text-header">BELONGS IN OUR HANDS</h1>
        </div>

        <div id="room-animation-7" class="text-container" style="display: none; opacity: 0;">
          <h1 class="medium-text">This is the beginning of a new kind of AI — collective and democratic</h1>
          <h1 class="medium-text">Hold your hand beneath the light to train & shape the model</h1>
        </div>

    </div>

    <div id="camera-animation" class="animation-container" style="display:none;">

      <div class="text-container">
        <div id="pre-recording-countdown" style="font-size: 24px; text-align: center; display: none; padding-top:60px">
          Hand detected, starting recording in: <span id="pre-countdown-timer">3</span>s
        </div>
      </div>
      
      <div id="recording-countdown" style="font-size: 24px; text-align: center; display: none; align-items: center; padding-top:60px">
        <div id="blinking-dot" style="width: 18px; height: 18px; background-color: red; border-radius: 50%; display: inline-block;"></div>
        Recording: <span id="countdown-timer">10</span>s
      </div>
      
      <div id="live-view-container" class="image-container" style="display:none">
        <img id="live-view" height="100%"/>
      </div>
    </div>

    <div id="training-animation" class="animation-container" style="display:none;">

      <div id="training-animation-1" class="text-container" style="display: none; opacity: 0;">
        <h1 class="medium-text">Re-training the model<br>This can take up to 15 seconds</h1>
        <!--
        <div id="training-images-container" style="display: flex; justify-content: center; gap: 20px; padding-top: 20px;">
        </div>-->
      </div>
    </div>

    <div id="visualization-animation" class="animation-container" style="display:none;">

      <div id="visualization-animation-1" class="text-container" style="display: none; opacity: 0;">
        <h1 id="token-display" class="medium-text" style="font-size: 46px;">Your token is 0000000</h1>
        <h1 class="medium-text">Save it — it lets you help guide the model in the future.</h1>
        <div id="image-grid-container" style="width:100%; display: flex; flex-direction: row; justify-content: center; align-items: center; position: relative; gap: 20px; padding-top: 20px;">
          <!-- Grids will be dynamically added here -->
        </div>
        <h1 class="medium-text">See the impact of your contribution, highlighted in red on the model screen.</h1>
      </div>
    </div>



    <script type="text/javascript" src="eel.js"></script>
    <script type="text/javascript" src="video_recoder.js"></script>

    <!-- GSAP CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script src="animation_top.js"></script>

    <script>

    function updateTokenDisplay(uuid) {
      const modelInfoElement = document.getElementById("token-display");
      const newText = `Your token is ${uuid}`;
      modelInfoElement.textContent = newText;
    }

    eel.expose(updateTokenDisplay);
      
      function generateImageGrid(gridRows = 4, gridColumns = 16, foldersToShow = ["unprocessed"]) {
        // Fetch the current UUID from Python
        eel.get_current_uuid()().then((uuid) => {
          if (!uuid) {
            console.error("UUID not found!");
            return;
          }

          // Define the base paths for the folders
          const basePaths = {
            unprocessed: `videos/${uuid}/unprocessed/`,
            noBG: `videos/${uuid}/no_BG/`,
            processedColour: `videos/${uuid}/processed_colour/`,
          };

          // Define the file suffixes for each folder
          const fileSuffixes = {
            unprocessed: ".jpg",
            noBG: "_noBG.png",
            processedColour: "_noBG_processed.png",
          };

          // Define custom text for each grid
          const gridTexts = {
            unprocessed: uuid + " Dataset",
            noBG: "Background Removed Grid",
            processedColour: "Processed Images Grid",
          };

          // Get the container for the grids
          const container = document.getElementById("image-grid-container");
          container.innerHTML = ""; // Clear any existing grids
          container.style.display = "flex"; // Ensure grids are displayed next to each other
          container.style.flexWrap = "wrap"; // Wrap grids if they exceed the container width
          container.style.gap = "12px"; // Add spacing between grids

          // Filter folders based on user input
          const filteredFolders = Object.keys(basePaths).filter((key) => foldersToShow.includes(key));

          // Create grids for each folder
          filteredFolders.forEach((key) => {
            // Create a wrapper for the grid
            const gridWrapper = document.createElement("div");
            gridWrapper.style.display = "flex";
            gridWrapper.style.flexDirection = "column";
            gridWrapper.style.alignItems = "center";
            gridWrapper.style.margin = "12px";

            // Create a container for the grid
            const gridContainer = document.createElement("div");
            gridContainer.style.display = "grid";
            gridContainer.style.gridTemplateColumns = `repeat(${gridColumns}, 60px)`;
            gridContainer.style.gridGap = "10px";

            // Calculate the total number of images based on rows and columns
            const totalImages = gridRows * gridColumns;

            // Create image elements for the grid
            for (let i = 0; i < totalImages; i++) {
              const frameIndex = i * 4;
              const img = document.createElement("img");
              img.style.width = "60px"; // Set image width
              img.style.height = "60px"; // Set image height
              img.style.objectFit = "cover"; // Ensure the images are cropped properly
              const imagePath = `${basePaths[key]}frame_${String(frameIndex).padStart(4, "0")}${fileSuffixes[key]}`;
              img.src = imagePath;

              // Handle image load errors
              img.onerror = () => {
                console.error(`Failed to load image: ${imagePath}`);
              };

              gridContainer.appendChild(img);
            }

            // Add the grid container to the wrapper
            gridWrapper.appendChild(gridContainer);

            // Add custom text under the grid
            const gridText = document.createElement("p");
            gridText.textContent = gridTexts[key]; // Use the custom text for the folder
            gridText.style.fontSize = "16px";
            gridText.style.textAlign = "center";
            gridWrapper.appendChild(gridText);

            // Append the wrapper to the main container
            container.appendChild(gridWrapper);
          });
        }).catch((error) => {
          console.error("Error fetching UUID:", error);
        });
      }
        eel.expose(generateImageGrid);


      function updateTrainingImages() {
        // Fetch the current UUID from Python
        eel.get_current_uuid()().then((uuid) => {
          if (!uuid) {
            console.error("UUID not found!");
            return;
          }

          // Define the base paths for the folders
          const basePaths = {
            unprocessed: `videos/${uuid}/unprocessed/`,
            noBG: `videos/${uuid}/no_BG/`,
            processedColour: `videos/${uuid}/processed_colour/`,
          };

          // Define the file suffixes for each folder
          const fileSuffixes = {
            unprocessed: ".jpg",
            noBG: "_noBG.png",
            processedColour: "_noBG_processed.png",
          };

          // Define custom text for each tile
          const tileTexts = {
            unprocessed: "Raw Images",
            noBG: "Background Removed",
            processedColour: "Black & White",
          };

          // Get the container for the images
          const container = document.getElementById("training-images-container");
          container.innerHTML = ""; // Clear any existing images

          // Create tiles for each folder
          Object.keys(basePaths).forEach((key, folderIndex) => {
            // Create a wrapper for the tile
            const tileWrapper = document.createElement("div");
            tileWrapper.style.display = "flex";
            tileWrapper.style.flexDirection = "column";
            tileWrapper.style.alignItems = "center";
            tileWrapper.style.margin = "20px";

            // Create a container for the images
            const tileContainer = document.createElement("div");
            tileContainer.style.display = "grid";
            tileContainer.style.gridTemplateColumns = "repeat(2, 150px)";
            tileContainer.style.gridGap = "10px";

            // Create image elements for the tile
            const imageElements = [];
            for (let i = 0; i < 4; i++) {
              const img = document.createElement("img");
              img.style.width = "150px"; // Set image width
              img.style.height = "150px"; // Set image height
              img.style.objectFit = "cover"; // Ensure the images are cropped properly
              tileContainer.appendChild(img);
              imageElements.push(img);
            }

            // Add the tile container to the wrapper
            tileWrapper.appendChild(tileContainer);

            // Add text under the tile
            const tileText = document.createElement("p");
            tileText.textContent = tileTexts[key]; // Use the folder name as the text
            tileText.style.fontSize = "16px";
            tileText.style.textAlign = "center";
            tileWrapper.appendChild(tileText);

            // Append the wrapper to the main container
            container.appendChild(tileWrapper);

            // Initialize the image index
            let imageIndex = 0;
            const totalImages = 150; // Total number of images in each folder
            const staggerOffsets = [0, 25, 50, 75];
            

            // Update images every 500ms, staggered by folderIndex * 100ms
            setInterval(() => {
            imageElements.forEach((img, imgIndex) => {
              const folderPath = basePaths[key];
              const fileSuffix = fileSuffixes[key];
              const startIndex = staggerOffsets[imgIndex]; // Get the starting offset for this image
              const currentIndex = (imageIndex + startIndex) % totalImages; // Calculate the current index
              const imagePath = `${folderPath}frame_${String(currentIndex).padStart(4, "0")}${fileSuffix}`;
              img.src = imagePath;

              // Handle image load errors
              img.onerror = () => {
                console.error(`Failed to load image: ${imagePath}`);
              };
            });

            // Increment the image index and restart if it reaches the total number of images
            imageIndex = (imageIndex + 1) % totalImages;
          }, 50); // Stagger updates by folderIndex * 100ms
          });
        }).catch((error) => {
          console.error("Error fetching UUID:", error);
        });
      }

      // Call this function when the training animation starts
      //updateTrainingImages();

        // Expose the function to Python
      eel.expose(updateTrainingImages);
    </script>
  
</body>
</html>